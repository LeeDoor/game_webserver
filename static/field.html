<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Web Game Grid</title>
    <style>
        body {
            background-color: lightgreen;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .grid {
            position:absolute;
            display: flex;
            flex-wrap: wrap;
            width: min(90vh, 90vw);
            height: min(90vh, 90vw);
            top: 0;
            left: 0;
            z-index: 0;
        }
        .players-field {
            position:absolute;
            display: flex;
            flex-wrap: wrap;
            width: min(90vh, 90vw);
            height: min(90vh, 90vw);
            top: 0;
            left: 0;
            z-index: 1;
        }
        .cell {
            position:relative;
            box-sizing: border-box;
            width: calc(100% / 15);
            height: calc(100% / 15);
            border: 1px solid darkgreen;
        }
        .wall {
            background-color: gray;
        }
        .grass {
            background-color: green;
        }
        .player {
            background-image: url('images/player1.png');
            background-size: contain;
            background-repeat: no-repeat;
            width: calc(100% / 15);
            height: calc(100% / 15);
            position: absolute;
            transition: top 0.1s, left 0.1s;
        }
        .enemy {
            background-image: url('images/player2.png');
            background-size: contain;
            background-repeat: no-repeat;
            width: calc(100% / 15);
            height: calc(100% / 15);
            position: absolute;
            transition: top 0.1s, left 0.1s;
        }
    </style>
</head>
<body>
    <div id="players-field" class="players-field"></div>
    <div class="grid" id="grid"></div>
    <script>
        const gridElement = document.getElementById('grid');
        const fieldElement = document.getElementById('players-field');
        const gridSize = 15;
        let field =[];
        let playerCell;
        let enemyCell;
        let player, enemy;
        function createGrid() {
            for (let y = 0; y < gridSize; ++y) {
                for(let x = 0; x < gridSize; ++x){
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    if (Math.random() > 0.9) {
                        cell.classList.add('wall');
                    } else {
                        cell.classList.add('grass');
                    }
                    cell.position_x = x;
                    cell.position_y = y;
                    cell.grid_index = y*gridSize + x;
                    gridElement.appendChild(cell);
                    field.push(cell);
                }
            }

            // Place player on a random grass cell
            const grassCells = field.filter(cell => cell.classList.contains('grass'));
            const randomIndex = Math.floor(Math.random() * grassCells.length);
            playerCell = grassCells[randomIndex];

            player = document.createElement('div');
            player.classList.add('player');
            player.style.top = playerCell.position_y/gridSize*100 + "%";
            player.style.left = playerCell.position_x /gridSize*100 + "%";
            fieldElement.appendChild(player);


            enemyCell = grassCells[randomIndex > 0? randomIndex-1 :randomIndex+1];
            enemy = document.createElement('div');
            enemy.classList.add('enemy');
            enemy.style.top = enemyCell.position_y/gridSize*100 + "%";
            enemy.style.left = enemyCell.position_x /gridSize*100 + "%";
            fieldElement.appendChild(enemy);
        }
        function movePlayer(direction) {
            let newPlayerCell;
            const currentIndex = playerCell.grid_index;
            const row = playerCell.position_y;
            const col = playerCell.position_x;

            switch (direction) {
                case 'up':
                    if (row > 0) newPlayerCell = gridElement.children[currentIndex - gridSize];
                    break;
                case 'down':
                    if (row < gridSize - 1) newPlayerCell = gridElement.children[currentIndex + gridSize];
                    break;
                case 'left':
                    if (col > 0) newPlayerCell = gridElement.children[currentIndex - 1];
                    break;
                case 'right':
                    if (col < gridSize - 1) newPlayerCell = gridElement.children[currentIndex + 1];
                    break;
            }
            
            function Visitable(cell){
                console.log(cell.position_x, cell.position_y);
                return cell.classList.contains('grass') && cell != enemyCell;
            }

            if (newPlayerCell && Visitable(newPlayerCell)) {
                player.style.top = newPlayerCell.position_y/gridSize*100 + "%";
                player.style.left = newPlayerCell.position_x/gridSize*100 + "%";
                playerCell = newPlayerCell;
            }
        }

        document.addEventListener('keydown', (event) => {
            switch (event.key) {
                case 'ArrowUp':
                case 'w':
                    movePlayer('up');
                    break;
                case 'ArrowDown':
                case 's':
                    movePlayer('down');
                    break;
                case 'ArrowLeft':
                case 'a':
                    movePlayer('left');
                    break;
                case 'ArrowRight':
                case 'd':
                    movePlayer('right');
                    break;
            }
        });
        createGrid();
    </script>
</body>
</html>